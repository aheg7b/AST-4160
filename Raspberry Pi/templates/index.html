<!DOCTYPE html>
<html>
<head>
  <title>Crop Monitor</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; background:#f5f5f5; }
    .device { background:white; padding:12px; margin:10px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .offline { border: 2px solid red;}
    select { margin-left:5px; }
  </style>
</head>
<body>
  <h1>Crop Monitor Dashboard</h1>
  {% for mac, info in data.items() %}
  <div class="device {% if not info['online'] %}offline{% endif %}">
    <h3>{{ info['name'] }} ({{ mac }})</h3>
    <div>Temp: {{ info['TEMP'] }} Â°C</div>
    <div>Humidity: {{ info['HUM'] }} %</div>
    <div>Soil Moisture: {{ info['MOIST'] }}</div>
    <div>Soil Temp: {{ info['SOILT'] }}</div>
    <div>Light Sensor: {{ info['LIGHT_VAL'] }}</div>
    <div>Last Seen: {{ info['last_seen'] }}</div>

    <div class="controls">
      <label>Pump:
        <select onchange="toggle('{{ mac }}','pump',this.value)">
          <option value="OFF" {% if info['PUMP']=='OFF' %}selected{% endif %}>OFF</option>
          <option value="ON" {% if info['PUMP']=='ON' %}selected{% endif %}>ON</option>
          <option value="AUTO" {% if info['PUMP']=='AUTO' %}selected{% endif %}>AUTO</option>
        </select>
      </label>
      <label>Light:
        <select onchange="toggle('{{ mac }}','light',this.value)">
          <option value="OFF" {% if info['LIGHT']=='OFF' %}selected{% endif %}>OFF</option>
          <option value="ON" {% if info['LIGHT']=='ON' %}selected{% endif %}>ON</option>
          <option value="AUTO" {% if info['LIGHT']=='AUTO' %}selected{% endif %}>AUTO</option>
        </select>
      </label>
    </div>
  </div>
  {% endfor %}

<script>
function toggle(mac,device,state){
    fetch(`/rename`,{
        method:"POST",
        headers: {"Content-Type":"application/x-www-form-urlencoded"},
        body:`mac=${mac}&name=${mac}`  // can rename device if needed
    });
    // send TCP command via backend endpoint (to be implemented)
}
</script>
</body>
</html>
